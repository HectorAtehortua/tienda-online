<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultado de Cotización</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1, h2 { color: #333; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #f2f2f2; }
    .total { font-weight: bold; background-color: #eaeaea; }
  </style>
</head>
<body>
  <h1>Resumen de Cotización</h1>

  <h2>Datos del Cliente</h2>
  <table>
    <tr><th>Campo</th><th>Datos</th></tr>
    <tr><td>Nombre</td><td id="resNombre"></td></tr>
    <tr><td>Ciudad</td><td id="resCiudad"></td></tr>
    <tr><td>Dirección</td><td id="resDireccion"></td></tr>
    <tr><td>Celular</td><td id="resCelular"></td></tr>
  </table>

  <h2>Productos Cotizados</h2>
  <table id="tablaProductos">
    <tr><th>Producto</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th></tr>
  </table>
  <h3 id="granTotal"></h3>

  <h2>Historial de Cotizaciones</h2>
  <table id="tablaHistorial">
    <tr><th>Nombre</th><th>Ciudad</th><th>Productos</th></tr>
  </table>

  <br>
  <button onclick="window.location.href='index.html'">Nueva Cotización</button>

  <script>
    // --- Obtener datos de localStorage ---
    const datos = JSON.parse(localStorage.getItem("cotizacion"));

    if (datos) {
      document.getElementById("resNombre").textContent = datos.nombre;
      document.getElementById("resCiudad").textContent = datos.ciudad;
      document.getElementById("resDireccion").textContent = datos.direccion;
      document.getElementById("resCelular").textContent = datos.celular;

      // Mostrar productos y calcular totales
      const tablaProductos = document.getElementById("tablaProductos");
      let totalGeneral = 0;

      datos.productos.forEach(p => {
        let subtotal = p.precio * p.cantidad;
        totalGeneral += subtotal;
        let fila = `<tr>
                      <td>${p.nombre}</td>
                      <td>${p.cantidad}</td>
                      <td>$${p.precio.toLocaleString()}</td>
                      <td>$${subtotal.toLocaleString()}</td>
                    </tr>`;
        tablaProductos.innerHTML += fila;
      });

      document.getElementById("granTotal").textContent = "Total a pagar: $" + totalGeneral.toLocaleString();

      // --- Guardar en historial ---
      let historial = JSON.parse(localStorage.getItem("historialCotizaciones")) || [];
      historial.push({
        nombre: datos.nombre,
        ciudad: datos.ciudad,
        productos: datos.productos.map(p => `${p.nombre} (${p.cantidad})`).join(", ")
      });
      localStorage.setItem("historialCotizaciones", JSON.stringify(historial));

      // --- Mostrar historial ---
      const tablaHistorial = document.getElementById("tablaHistorial");
      historial.forEach(c => {
        let fila = `<tr>
                      <td>${c.nombre}</td>
                      <td>${c.ciudad}</td>
                      <td>${c.productos}</td>
                    </tr>`;
        tablaHistorial.innerHTML += fila;
      });
    } else {
      document.body.innerHTML = "<h2>No hay datos de cotización disponibles</h2>";
    }
  </script>
</body>
</html>
